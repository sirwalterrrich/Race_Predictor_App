<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Race Predictor and Pace Tracker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
        .tab {
            display: none; /* Hide tabs by default */
        }
        .tab-links {
            display: flex;
            cursor: pointer;
            margin-bottom: 20px;
        }
        .tab-links div {
            padding: 10px;
            background: #f1f1f1;
            margin-right: 5px;
            border: 1px solid #ccc;
        }
        .tab-links div.active {
            background: #e7e7e7;
            border-bottom: 1px solid white; /* Creates an overlap effect */
        }
        .display {
            background-color: #333;
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            font-size: 2em; /* Increase font size for better visibility */
            text-align: center;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>Race Predictor & Pace Tracker</h1>
            <a href="https://github.com/sirwalterrrich" target="_blank" class="github-link" aria-label="Visit my GitHub">
                <img src="{{ url_for('static', filename='github-logo.png') }}" alt="GitHub Logo" class="github-logo">
                Visit my GitHub
            </a>
        </div>
    </header>
    <main class="container">
        <div class="tab-links">
            <div id="tab-calculate" class="active" onclick="showTab('calculate')">Calculate Your Race Pace</div>
            <div id="tab-stopwatch" onclick="showTab('stopwatch')">Stopwatch and Timer</div>
            <div id="tab-upcoming-races" onclick="showTab('upcoming-races')">Upcoming Races</div>
            <div id="tab-chatroom" onclick="showTab('chatroom')">Live Chatroom</div>
        </div>

        <div id="calculate" class="tab" style="display: block;">
            <h2>Calculate Your Race Pace</h2>
            <label for="distance">Distance (0 km to 50 km): <span id="distance-display">0 km</span></label>
            <div class="slider-container">
                <input type="range" id="distance" min="0" max="50" value="0" step="0.1" oninput="updateDistance()">
            </div>

            <label for="time">Time (0 mins to 6 hours): <span id="time-display">0 mins</span></label>
            <input type="range" id="time" min="0" max="21600" value="0" step="1" oninput="updateTime()">

            <button onclick="calculatePace()">Calculate Pace</button>

            <div id="results">
                <h3>Results</h3>
                <p>Pace (min/km): <span id="pace-km"></span></p>
                <p>Pace (min/mile): <span id="pace-miles"></span></p>
                <p>Speed (miles/hour): <span id="speed"></span></p>

                <h4>Predicted Times for Common Distances</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Distance</th>
                            <th>Predicted Time (min)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>5k</td>
                            <td id="pred-5k"></td>
                        </tr>
                        <tr>
                            <td>10k</td>
                            <td id="pred-10k"></td>
                        </tr>
                        <tr>
                            <td>Half Marathon</td>
                            <td id="pred-half-marathon"></td>
                        </tr>
                        <tr>
                            <td>Marathon</td>
                            <td id="pred-marathon"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="stopwatch" class="tab">
            <h2>Stopwatch and Timer</h2>
            <h3>Stopwatch</h3>
            <div id="stopwatch-display" class="display">00:00.0</div>
            <button onclick="startStopwatch()">Start</button>
            <button onclick="stopStopwatch()">Stop</button>
            <button onclick="resetStopwatch()">Reset</button>

            <h3>Countdown Timer</h3>
            <label for="countdown-input">Set Timer (in seconds):</label>
            <input type="number" id="countdown-input" min="1" value="60">
            <button onclick="startCountdown()">Start Countdown</button>
            <div id="countdown-display" class="display">00:00</div>
        </div>

        <div id="upcoming-races" class="tab">
            <h2>Upcoming Races</h2>
            <ul>
                <li>Race 1: Date, Location</li>
                <li>Race 2: Date, Location</li>
                <li>Race 3: Date, Location</li>
                <!-- Add more race details as needed -->
            </ul>
        </div>

        <div id="chatroom" class="tab">
            <h2>Live Chatroom</h2>
            <h3>This feature is coming later</h3>
            <div class="chat-container">
                <div id="chat-messages"></div>
                <input type="text" id="chat-input" placeholder="Type a message..." />
                <button onclick="sendMessage()">Send</button>
            </div>
        </div>

        <section id="soundboard-section">
            <h3>Soundboard</h3>
            <button class="sound-button" onclick="playSound('sound1.mp3')">Sound 1</button>
            <button class="sound-button" onclick="playSound('sound2.mp3')">Sound 2</button>
            <button class="sound-button" onclick="playSound('sound3.mp3')">Sound 3</button>
        </section>
    </main>

    <script>
        let stopwatchInterval;
        let stopwatchTime = 0; // in milliseconds

        function startStopwatch() {
            clearInterval(stopwatchInterval);
            stopwatchInterval = setInterval(() => {
                stopwatchTime += 100; // Increment by 100ms
                const minutes = Math.floor(stopwatchTime / 60000);
                const seconds = Math.floor((stopwatchTime % 60000) / 1000);
                const tenths = Math.floor((stopwatchTime % 1000) / 100); // Get tenths of a second
                document.getElementById('stopwatch-display').innerText = 
                    `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}.${tenths}`;
            }, 100); // Update every 100 milliseconds
        }

        function stopStopwatch() {
            clearInterval(stopwatchInterval);
        }

        function resetStopwatch() {
            stopStopwatch();
            stopwatchTime = 0;
            document.getElementById('stopwatch-display').innerText = '00:00.0';
        }

        function showTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.style.display = 'none';
            });

            // Remove active class from all tab links
            const tabLinks = document.querySelectorAll('.tab-links div');
            tabLinks.forEach(link => {
                link.classList.remove('active');
            });

            // Show the selected tab and set it as active
            document.getElementById(tabName).style.display = 'block';
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }

        // Initialize to show the Calculate Your Race Pace tab
        window.onload = function() {
            showTab('calculate'); // Initialize with the Race Pace tab shown
            updateDistance(); // Initialize the displayed distance
        };

        function updateDistance() {
            const distanceInput = document.getElementById('distance');
            document.getElementById('distance-display').innerText = distanceInput.value + ' km';
        }

        function updateTime() {
            const timeInput = document.getElementById('time');
            const totalSeconds = timeInput.value;
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            document.getElementById('time-display').innerText = `${minutes} mins ${seconds} secs`;
        }

        function calculatePace() {
            const distance = parseFloat(document.getElementById('distance').value);
            const time = parseFloat(document.getElementById('time').value);
            fetch('/calculate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ distance: distance, time: time })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('pace-km').innerText = data.pace_km;
                document.getElementById('pace-miles').innerText = data.pace_miles;
                document.getElementById('speed').innerText = data.speed;

                document.getElementById('pred-5k').innerText = data.predictions['5k'].toFixed(2);
                document.getElementById('pred-10k').innerText = data.predictions['10k'].toFixed(2);
                document.getElementById('pred-half-marathon').innerText = data.predictions['half_marathon'].toFixed(2);
                document.getElementById('pred-marathon').innerText = data.predictions['marathon'].toFixed(2);
            })
            .catch(error => {
                console.error('Error calculating pace:', error);
            });
        }

        function startCountdown() {
            resetStopwatch(); // Reset stopwatch before starting countdown
            const countdownInput = document.getElementById('countdown-input').value;
            let countdownTime = parseInt(countdownInput, 10);

            if (countdownTime > 0) {
                clearInterval(countdownInterval);
                countdownInterval = setInterval(() => {
                    if (countdownTime <= 0) {
                        clearInterval(countdownInterval);
                        document.getElementById('countdown-display').innerText = '00:00';
                        alert('Countdown complete!');
                    } else {
                        const minutes = Math.floor(countdownTime / 60);
                        const seconds = countdownTime % 60;
                        document.getElementById('countdown-display').innerText = 
                            `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                        countdownTime--;
                    }
                }, 1000);
            }
        }

        function sendMessage() {
            const messageInput = document.getElementById('chat-input');
            const message = messageInput.value;
            if (message) {
                const chatMessages = document.getElementById('chat-messages');
                const messageElement = document.createElement('div');
                messageElement.innerText = message;
                chatMessages.appendChild(messageElement);
                messageInput.value = '';
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }

        function playSound(soundFile) {
            const audio = new Audio(`static/${soundFile}`);
            audio.play();
        }
    </script>
</body>
</html>
